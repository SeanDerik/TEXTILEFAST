CREATE TABLE `avaliacoes_fornecedores` (
  `avaliacao_id` int(11) NOT NULL AUTO_INCREMENT,
  `comprador_id` int(11) DEFAULT NULL,
  `fornecedor_id` int(11) DEFAULT NULL,
  `qualidade` int(11) DEFAULT NULL,
  `condicoes_financeiras` int(11) DEFAULT NULL,
  `pontualidade` int(11) DEFAULT NULL,
  `prazo_entrega` int(11) DEFAULT NULL,
  `comentario` text DEFAULT NULL,
  `data_avaliacao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`avaliacao_id`),
  KEY `comprador_id` (`comprador_id`),
  KEY `fornecedor_id` (`fornecedor_id`),
  CONSTRAINT `avaliacoes_fornecedores_ibfk_1` FOREIGN KEY (`comprador_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE SET NULL,
  CONSTRAINT `avaliacoes_fornecedores_ibfk_2` FOREIGN KEY (`fornecedor_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE,
  CONSTRAINT `avaliacoes_fornecedores_chk_1` CHECK (`qualidade` between 1 and 5),
  CONSTRAINT `avaliacoes_fornecedores_chk_2` CHECK (`condicoes_financeiras` between 1 and 5),
  CONSTRAINT `avaliacoes_fornecedores_chk_3` CHECK (`pontualidade` between 1 and 5),
  CONSTRAINT `avaliacoes_fornecedores_chk_4` CHECK (`prazo_entrega` between 1 and 5)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `carrinho` (
  `carrinho_id` int(11) NOT NULL AUTO_INCREMENT,
  `comprador_id` int(11) NOT NULL,
  `data_criacao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`carrinho_id`),
  KEY `comprador_id` (`comprador_id`),
  CONSTRAINT `carrinho_ibfk_1` FOREIGN KEY (`comprador_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `categorias` (
  `categoria_id` int(11) NOT NULL AUTO_INCREMENT,
  `nome_categoria` varchar(100) NOT NULL,
  `descricao` text DEFAULT NULL,
  PRIMARY KEY (`categoria_id`),
  UNIQUE KEY `nome_categoria` (`nome_categoria`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4;

CREATE TABLE `configuracoes_empresa` (
  `configuracao_id` int(11) NOT NULL AUTO_INCREMENT,
  `empresa_id` int(11) NOT NULL,
  `chave` varchar(100) NOT NULL,
  `valor` text DEFAULT NULL,
  PRIMARY KEY (`configuracao_id`),
  KEY `empresa_id` (`empresa_id`),
  CONSTRAINT `configuracoes_empresa_ibfk_1` FOREIGN KEY (`empresa_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `configuracoes_seguranca` (
  `seguranca_id` int(11) NOT NULL AUTO_INCREMENT,
  `usuario_id` int(11) NOT NULL,
  `dois_fatores` tinyint(1) DEFAULT 0,
  `pergunta_seguranca` varchar(255) DEFAULT NULL,
  `resposta_seguranca` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`seguranca_id`),
  KEY `usuario_id` (`usuario_id`),
  CONSTRAINT `configuracoes_seguranca_ibfk_1` FOREIGN KEY (`usuario_id`) REFERENCES `usuarios` (`usuario_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `documentos_fiscais` (
  `documento_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `pedido_id` int(11) DEFAULT NULL,
  `numero_nota_fiscal` varchar(50) NOT NULL,
  `caminho_documento` text DEFAULT NULL,
  `data_emissao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`documento_id`),
  UNIQUE KEY `documento_id` (`documento_id`),
  KEY `pedido_id` (`pedido_id`),
  CONSTRAINT `documentos_fiscais_ibfk_1` FOREIGN KEY (`pedido_id`) REFERENCES `pedidos` (`pedido_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `empresas` (
  `empresa_id` int(11) NOT NULL AUTO_INCREMENT,
  `cnpj` varchar(14) NOT NULL,
  `razao_social` varchar(255) NOT NULL,
  `nome_fantasia` varchar(255) DEFAULT NULL,
  `tipo_empresa` enum('comprador','fornecedor') NOT NULL,
  `email` varchar(255) NOT NULL,
  `telefone` varchar(255) DEFAULT NULL,
  `endereco` text DEFAULT NULL,
  `data_cadastro` timestamp NULL DEFAULT current_timestamp(),
  `senha` varchar(45) NOT NULL,
  `reclameaqui` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`empresa_id`),
  UNIQUE KEY `cnpj` (`cnpj`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

CREATE TABLE `enderecos` (
  `endereco_id` int(11) NOT NULL AUTO_INCREMENT,
  `empresa_id` int(11) NOT NULL,
  `tipo` enum('comercial','entrega','faturamento') NOT NULL,
  `endereco` text NOT NULL,
  `cidade` varchar(100) NOT NULL,
  `estado` varchar(100) NOT NULL,
  `cep` varchar(10) NOT NULL,
  `pais` varchar(100) NOT NULL,
  PRIMARY KEY (`endereco_id`),
  KEY `empresa_id` (`empresa_id`),
  CONSTRAINT `enderecos_ibfk_1` FOREIGN KEY (`empresa_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `historico_precos` (
  `historico_id` int(11) NOT NULL AUTO_INCREMENT,
  `produto_id` int(11) NOT NULL,
  `preco_anterior` decimal(10,2) NOT NULL,
  `preco_novo` decimal(10,2) NOT NULL,
  `data_alteracao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`historico_id`),
  KEY `produto_id` (`produto_id`),
  CONSTRAINT `historico_precos_ibfk_1` FOREIGN KEY (`produto_id`) REFERENCES `produtos` (`produto_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `imagens_produtos` (
  `imagem_id` int(11) NOT NULL AUTO_INCREMENT,
  `produto_id` int(11) NOT NULL,
  `url_imagem` text NOT NULL,
  `descricao` text DEFAULT NULL,
  `data_upload` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`imagem_id`),
  KEY `produto_id` (`produto_id`),
  CONSTRAINT `imagens_produtos_ibfk_1` FOREIGN KEY (`produto_id`) REFERENCES `produtos` (`produto_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `itens_carrinho` (
  `item_carrinho_id` int(11) NOT NULL AUTO_INCREMENT,
  `carrinho_id` int(11) NOT NULL,
  `produto_id` int(11) NOT NULL,
  `quantidade` int(11) NOT NULL,
  `data_adicionado` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`item_carrinho_id`),
  KEY `carrinho_id` (`carrinho_id`),
  KEY `produto_id` (`produto_id`),
  CONSTRAINT `itens_carrinho_ibfk_1` FOREIGN KEY (`carrinho_id`) REFERENCES `carrinho` (`carrinho_id`) ON DELETE CASCADE,
  CONSTRAINT `itens_carrinho_ibfk_2` FOREIGN KEY (`produto_id`) REFERENCES `produtos` (`produto_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `itens_pedido` (
  `item_id` int(11) NOT NULL AUTO_INCREMENT,
  `pedido_id` int(11) DEFAULT NULL,
  `produto_id` int(11) DEFAULT NULL,
  `quantidade` int(11) NOT NULL,
  `preco_unitario` decimal(10,2) NOT NULL,
  PRIMARY KEY (`item_id`),
  KEY `pedido_id` (`pedido_id`),
  KEY `produto_id` (`produto_id`),
  CONSTRAINT `itens_pedido_ibfk_1` FOREIGN KEY (`pedido_id`) REFERENCES `pedidos` (`pedido_id`) ON DELETE CASCADE,
  CONSTRAINT `itens_pedido_ibfk_2` FOREIGN KEY (`produto_id`) REFERENCES `produtos` (`produto_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `logs_acesso` (
  `log_id` int(11) NOT NULL AUTO_INCREMENT,
  `usuario_id` int(11) DEFAULT NULL,
  `acao` varchar(255) NOT NULL,
  `detalhes` text DEFAULT NULL,
  `data_acesso` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`log_id`),
  KEY `usuario_id` (`usuario_id`),
  CONSTRAINT `logs_acesso_ibfk_1` FOREIGN KEY (`usuario_id`) REFERENCES `usuarios` (`usuario_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `mensagens` (
  `mensagem_id` int(11) NOT NULL AUTO_INCREMENT,
  `remetente_id` int(11) NOT NULL,
  `destinatario_id` int(11) NOT NULL,
  `conteudo` text NOT NULL,
  `data_mensagem` timestamp NULL DEFAULT current_timestamp(),
  `lida` tinyint(1) DEFAULT 0,
  PRIMARY KEY (`mensagem_id`),
  KEY `remetente_id` (`remetente_id`),
  KEY `destinatario_id` (`destinatario_id`),
  CONSTRAINT `mensagens_ibfk_1` FOREIGN KEY (`remetente_id`) REFERENCES `usuarios` (`usuario_id`) ON DELETE CASCADE,
  CONSTRAINT `mensagens_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`usuario_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `notificacoes` (
  `notificacao_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `empresa_id` int(11) DEFAULT NULL,
  `mensagem` text DEFAULT NULL,
  `lida` tinyint(1) DEFAULT 0,
  `data_notificacao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`notificacao_id`),
  UNIQUE KEY `notificacao_id` (`notificacao_id`),
  KEY `empresa_id` (`empresa_id`),
  CONSTRAINT `notificacoes_ibfk_1` FOREIGN KEY (`empresa_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `pagamentos` (
  `pagamento_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `pedido_id` int(11) DEFAULT NULL,
  `valor_pago` decimal(10,2) NOT NULL,
  `data_pagamento` timestamp NULL DEFAULT current_timestamp(),
  `metodo_pagamento` enum('boleto','cartao_credito','transferencia') NOT NULL,
  PRIMARY KEY (`pagamento_id`),
  UNIQUE KEY `pagamento_id` (`pagamento_id`),
  KEY `pedido_id` (`pedido_id`),
  CONSTRAINT `pagamentos_ibfk_1` FOREIGN KEY (`pedido_id`) REFERENCES `pedidos` (`pedido_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `pedidos` (
  `pedido_id` int(11) NOT NULL AUTO_INCREMENT,
  `comprador_id` int(11) DEFAULT NULL,
  `fornecedor_id` int(11) DEFAULT NULL,
  `total` decimal(10,2) NOT NULL,
  `data_pedido` timestamp NULL DEFAULT current_timestamp(),
  `status` enum('pendente','pago','enviado','concluido','cancelado') NOT NULL,
  PRIMARY KEY (`pedido_id`),
  KEY `comprador_id` (`comprador_id`),
  KEY `fornecedor_id` (`fornecedor_id`),
  CONSTRAINT `pedidos_ibfk_1` FOREIGN KEY (`comprador_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE,
  CONSTRAINT `pedidos_ibfk_2` FOREIGN KEY (`fornecedor_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `preferencias_notificacao` (
  `preferencia_id` int(11) NOT NULL AUTO_INCREMENT,
  `empresa_id` int(11) NOT NULL,
  `tipo_notificacao` enum('email','sms','in-app') NOT NULL,
  `ativo` tinyint(1) DEFAULT 1,
  PRIMARY KEY (`preferencia_id`),
  KEY `empresa_id` (`empresa_id`),
  CONSTRAINT `preferencias_notificacao_ibfk_1` FOREIGN KEY (`empresa_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `produtos` (
  `produto_id` int(11) NOT NULL AUTO_INCREMENT,
  `nome_produto` varchar(255) NOT NULL,
  `descricao` text DEFAULT NULL,
  `preco` decimal(10,2) NOT NULL,
  `estoque` int(11) NOT NULL,
  `fornecedor_id` int(11) NOT NULL,
  `categoria_id` int(11) NOT NULL,
  `imagem_url` varchar(255) DEFAULT NULL,
  `data_cadastro` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`produto_id`),
  KEY `fornecedor_id` (`fornecedor_id`),
  KEY `categoria_id` (`categoria_id`),
  CONSTRAINT `produtos_ibfk_1` FOREIGN KEY (`fornecedor_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE,
  CONSTRAINT `produtos_ibfk_2` FOREIGN KEY (`categoria_id`) REFERENCES `categorias` (`categoria_id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

CREATE TABLE `promocoes` (
  `promocao_id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo` varchar(50) NOT NULL,
  `descricao` text DEFAULT NULL,
  `desconto_percentual` decimal(5,2) DEFAULT NULL,
  `desconto_valor` decimal(10,2) DEFAULT NULL,
  `data_inicio` date NOT NULL,
  `data_fim` date NOT NULL,
  `quantidade_disponivel` int(11) DEFAULT NULL,
  `ativo` tinyint(1) DEFAULT 1,
  PRIMARY KEY (`promocao_id`),
  UNIQUE KEY `codigo` (`codigo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `reclamacoes_fornecedores` (
  `reclamacao_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `comprador_id` int(11) DEFAULT NULL,
  `fornecedor_id` int(11) DEFAULT NULL,
  `descricao` text NOT NULL,
  `status` enum('pendente','resolvida','fechada') DEFAULT 'pendente',
  `data_reclamacao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`reclamacao_id`),
  UNIQUE KEY `reclamacao_id` (`reclamacao_id`),
  KEY `comprador_id` (`comprador_id`),
  KEY `fornecedor_id` (`fornecedor_id`),
  CONSTRAINT `reclamacoes_fornecedores_ibfk_1` FOREIGN KEY (`comprador_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE SET NULL,
  CONSTRAINT `reclamacoes_fornecedores_ibfk_2` FOREIGN KEY (`fornecedor_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `relatorios` (
  `relatorio_id` int(11) NOT NULL AUTO_INCREMENT,
  `empresa_id` int(11) DEFAULT NULL,
  `tipo_relatorio` enum('vendas','estoque','avaliacoes') NOT NULL,
  `dados` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL CHECK (json_valid(`dados`)),
  `data_geracao` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`relatorio_id`),
  KEY `empresa_id` (`empresa_id`),
  CONSTRAINT `relatorios_ibfk_1` FOREIGN KEY (`empresa_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `taxas_impostos` (
  `taxa_id` int(11) NOT NULL AUTO_INCREMENT,
  `descricao` varchar(255) NOT NULL,
  `percentual` decimal(5,2) NOT NULL,
  `tipo` enum('imposto','taxa') NOT NULL,
  PRIMARY KEY (`taxa_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `usuarios` (
  `usuario_id` int(11) NOT NULL AUTO_INCREMENT,
  `empresa_id` int(11) NOT NULL,
  `nome` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `senha_hash` varchar(255) NOT NULL,
  `papel` enum('administrador','operador_triagem','especialista','comprador') NOT NULL,
  `data_criacao` timestamp NULL DEFAULT current_timestamp(),
  `ultimo_login` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`usuario_id`),
  UNIQUE KEY `email` (`email`),
  KEY `empresa_id` (`empresa_id`),
  CONSTRAINT `usuarios_ibfk_1` FOREIGN KEY (`empresa_id`) REFERENCES `empresas` (`empresa_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
